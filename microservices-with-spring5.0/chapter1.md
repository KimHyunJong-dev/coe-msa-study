# 1장. ‘쉽게 알아보는 마이크로서비스’

### 마이크로서비스로의 진화
비즈니스적 요구
- 마이크로서비스가 전달 신속성, 확장성, 애자일성 면에서 우수
- 마이크로서비스를 통해 전환시간, 소모비용 절감 가능

(개인화 엔진, 추천 엔진 추가 사례)

새로운 기능은 마이크로서비스로 작성하여 응답시 새로운 기능 추가, 새로운 기능을 기존 시스템에서 호출하도록 변경하는 형태로 구성  


- 기술

새로운 기술 패러다임 변화는 모든 계층의의 소프트웨어 아키텍처 구조의 변화를 가져옴

  * NoSQL
  * 클라이언트 자바스크립트 프레임워크
  * 클라우드 -> PaaS
  * 도커
  * 서버리스 아키텍처 등


### 마이크로서비스란 무엇인가?

마틴 파울러의 정의 (마이크로서비스 아키텍처)
- 별도의 프로세스에서 실행,
- API를 통해 통신(느슨한 결합),
- 자동화된 절차에 따라 독립적으로 배포가능,
- 다양한 언어나 데이터 저장 기술 사용 가능한 작은 서비스를 모아 하나의 어플리케이션 구성
- 작은 서비스를 관리하기 위한 중앙 관리 방식은 최소화

N-tier 어플리케이션 vs 마이크로서비스
(그림)

### 마이크로서비스 원칙

서비스 하나에 책임 하나
- 서비스간 결합도 낮추기 위함

자율적 서비스
- 독립적으로 배포
- 비즈니스의 범위와 실행에 대한 전적임 책임
- 라이브러리 의존성을 포함한 웹서버, 컨테이너, 물리적 자원 추상화한 가상 머신 포함 (SOA와의 차이) -> 도커 컨테이너 기술 적용 Good

### 마이크로서비스 특징

서비스는 일급 시민
- 종단점 API 형태로 외부 노출
- 구현 로직, 아키텍처, DB, 품질 등 세부 사항은 추상화
- 개발조직은 애플리케이션 개발보다 서비스 개발에 더 중점을 둠
- SOA 서비스 특성 중 마이크로서비스에 적용할 수 있는 특성들
  * 서비스 계약 : JSON/REST
  * 느슨한 결합 : 메시징, HTTP REST
  * 서비스 재사용
  * 무상태(Stateless) : 서비스에 의해 관리되는 상태 정보 공유하지 않음, 필요시 DB, 메모리 사용하여 상태 관리
  * 탐색가능 서비스(discoverable service)
  * 서비스 호환성 : 표준 프로토콜과 메시지 교환 표준 준수, REST/JSON
  * 서비스 조립성

마이크로 서비스는 가볍다
- Jetty, Tomcat 이 웹로직, 웹스피어에 비해 적합
- 도커 컨테이너 기술 적용 용이

다양한 언어로 구성할 수 있다
  (예) 검색 서비스 Erlang, elasticSearch, 예약 서비스는 Java, MySQL로 구성

자동화
- 여러 개의 작은 서비스로 분화되므로 관리 부담을 줄이기 위해 자동화는 필수임
- 빌드, 테스팅, 릴리스 배포 전단계 자동화 필요
- git 과 같은 형상관리 도구, jenkins, travis CI등과 같은 CI 도구 사용
- 코드 품질 검사 및 테스트 자동화 포함
- 일체형에 비해 테스트 케이스 수가 상대적으로 작아 빌드시 회귀 테스트 진행 가능
- 도커 컨테이너, Chef, Puppet 등 릴리스 관리 도구, Ansible 과 같은 구성 관리 도구를 사용하여 인프라스트럭처 프로비저닝 자동화
- 스프링 클라우드, Kubernetes, Mesos, Marahon 등의 도구로 배포 자동화   
동적이고 분산되어 있는 마이크로서비스

마이크로서비스 구현체는 로직과 데이터를 서비스의 내부로 캡슐화
- 물리적으로 데이터, 로직 분리
- SOA 에서의 ESB(Enterprise Service Bus)와 같은 무거운 제품에 관리 체계 의존하지 않음
- 마이크로서비스 구현체는 실행환경에서 동적으로 레지스트리 정보 구축

붕괴 저항성(Antifragility), 빨리 실패하기(Fail fast), 자체 치유
- Antifragility : 안전장치가 포함된 시스템 ?
- fail fast : 장애를 예상하고 대응할 수 있는 시스템 개발하는데 중점 (장애 없는 시스템 x), MTBF(Mean Time Between Failure) => MTTR(Mean Time To Recovery)
- self-Recovery : 시스템이 장애로부터 학습, 적음

### 마이크로서비스의 장점
폴리글랏 아키텍처 지원 : 주어진 시나리오에 가장 적합한 기술과 아키텍처 선택하여 유연성, 목적에 부합하는 솔루션 설계 가능

실험 혁신 유도 : 빠르게 시도해보고 실패하는 방식

탄력적, 선택적 확장 가능
- 스케일 큐브
  * x축 : 어플리케이션 복제 수평적으로 확장
  * y축: 서로 다른 기능 분리
  * z축: 데이터 파티셔닝, 샤딩
대체 가능성
유기적 시스템 구축 유도
- 유기적 시스템 : 시간이 지남에 따라 필요한 기능을 추가하면서 성장하는 시스템
- 마이크로서비스에서는 새로운 서비스를 추가하더라도 기존 서비스에 미치는 영향을 최소화할 수 있음

기술 부채 경감 : 작은 단위로 점진적으로 진행

다양 버전 존재

자기 조직화 시스템 구축 지원

이벤트 주도 아키텍처 지원
- 입력 및 출력 이벤트를 통해서만 동작
- 이벤트 접근 연결하여 사용하기 용이(타 서비스, 분석, 집계 등)

데브옵스 지원




> ???

- 서비스 지향 아키텍처(SOA)
- 육각형 아키텍처
- SOLID 디자인 패턴
- ACID,
- 투웨이 커밋
- 회귀 테스트
- 인프라스트럭처 프로비저닝
- 붕괴저항성
- 스케일 큐브
